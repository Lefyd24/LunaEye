<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="LunaEye - Your futuristic AI personal assistant with 3D fluid visualization">
    <meta name="theme-color" content="#06b6d4">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>LunaEye - AI Assistant</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="./manifest.json">
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='40' fill='%2306b6d4'/%3E%3Ccircle cx='50' cy='50' r='20' fill='%23fff'/%3E%3C/svg%3E" type="image/svg+xml">
    
    <style>
        /* ============================================
           LUNAEYE - Futuristic AI Interface
           Design: Liquid Glassmorphism with Personality
        ============================================ */
        
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap');
        
        :root {
            /* Vibrant State Colors - CYAN PRIMARY */
            --color-idle: #06b6d4;
            --color-listening: #06b6d4;
            --color-thinking: #f59e0b;
            --color-speaking: #10b981;
            --color-waking: #06b6d4;
            --color-error: #ef4444;
            
            /* Neon Accents - CYAN THEME */
            --neon-cyan: #06b6d4;
            --neon-magenta: #06b6d4;
            --neon-purple: #06b6d4;
            --neon-blue: #0891b2;
            
            /* Current state (updated by JS) */
            --state-color: var(--color-idle);
            --state-glow: var(--color-idle);
            
            /* Glassmorphism */
            --glass-bg: rgba(15, 15, 25, 0.4);
            --glass-border: rgba(255, 255, 255, 0.15);
            --glass-shine: rgba(255, 255, 255, 0.1);
            
            /* Typography */
            --font-display: 'Orbitron', monospace;
            --font-body: 'Rajdhani', sans-serif;
        }
        
        /* ============================================
           Base & Reset
        ============================================ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: #000;
        }
        
        body {
            font-family: var(--font-body);
            color: #fff;
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            position: relative;
        }
        
        /* ============================================
           Fluid Background - Clean WebGL Only
        ============================================ */
        #fluid-container {
            position: fixed;
            inset: 0;
            z-index: 1;
            background: #0a0a0f;
        }
        
        /* ============================================
           No extra backgrounds - pure black
        ============================================ */
        
        /* ============================================
           Main Container - Full Screen Centered
        ============================================ */
        .ai-interface {
            position: fixed;
            inset: 0;
            z-index: 10;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            gap: 1rem;
        }
        
        /* ============================================
           Liquid Glass Card
        ============================================ */
        .liquid-glass {
            background: var(--glass-bg);
            backdrop-filter: blur(30px) saturate(180%);
            -webkit-backdrop-filter: blur(30px) saturate(180%);
            border: 1px solid var(--glass-border);
            border-radius: 2rem;
            position: relative;
            overflow: hidden;
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.2),
                0 0 60px rgba(var(--state-color), 0.1);
        }
        
        .liquid-glass::before {
            content: '';
            position: absolute;
            inset: -2px;
            background: linear-gradient(
                135deg,
                transparent 0%,
                var(--glass-shine) 40%,
                transparent 60%,
                var(--glass-shine) 100%
            );
            opacity: 0;
            transition: opacity 0.6s;
            pointer-events: none;
            z-index: 1;
        }
        
        .liquid-glass:hover::before {
            opacity: 1;
            animation: liquidShine 3s ease-in-out infinite;
        }
        
        @keyframes liquidShine {
            0% { transform: translateX(-100%) translateY(-100%) rotate(30deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(30deg); }
        }
        
        /* ============================================
           Footer Control Buttons
        ============================================ */
        .ai-footer .ai-btn {
            flex-shrink: 0;
        }
        
        .mic-btn-footer {
            background: rgba(6, 182, 212, 0.2) !important;
            border-color: rgba(6, 182, 212, 0.4) !important;
        }
        
        .mic-btn-footer.active {
            background: rgba(6, 182, 212, 0.4) !important;
            box-shadow: 0 0 20px rgba(6, 182, 212, 0.6) !important;
        }
        
        .mic-btn-footer.muted {
            background: rgba(255, 100, 100, 0.2) !important;
            border-color: rgba(255, 100, 100, 0.4) !important;
        }
        
        .mic-btn-footer.muted svg {
            color: rgba(255, 100, 100, 0.8);
        }
        
        .status-info {
            flex: 1;
            text-align: center;
        }
        
        /* Keep the name but hide it - used only for branding reference */
        .ai-name {
            font-family: var(--font-display);
            font-size: 1.5rem;
            font-weight: 900;
            letter-spacing: 0.15em;
            background: linear-gradient(
                135deg,
                var(--neon-cyan),
                var(--neon-magenta),
                var(--neon-purple)
            );
            background-size: 200% 200%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientText 5s ease infinite;
            text-shadow: 0 0 30px rgba(0, 240, 255, 0.5);
        }
        
        @keyframes gradientText {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        .ai-controls {
            display: flex;
            gap: 1rem;
            position: relative;
            z-index: 2;
        }
        
        .ai-btn {
            width: 48px;
            height: 48px;
            border: none;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        .ai-btn::before {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(circle, var(--state-color) 0%, transparent 70%);
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .ai-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--state-color);
            transform: translateY(-2px);
            box-shadow: 0 0 20px var(--state-color);
        }
        
        .ai-btn:hover::before {
            opacity: 0.3;
        }
        
        .ai-btn svg {
            width: 20px;
            height: 20px;
            color: #fff;
            position: relative;
            z-index: 1;
        }
        
        /* ============================================
           Central Brain - Main Display
        ============================================ */
        .ai-brain {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 1.5rem;
            padding: 0;
            position: fixed;
            top: 15%;
            left: 50%;
            transform: translateX(-50%);
            z-index: 50;
            pointer-events: none;
        }
        
        .ai-brain > * {
            pointer-events: auto;
        }
        
        /* ============================================
           SIRI-STYLE VOICE VISUALIZER
           Fluid Gradient Orb with Wave Animations
         ============================================ */
        .ai-entity {
            width: 320px;
            height: 320px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: visible;
            border-radius: 50%;
        }
        
        .voice-circle {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            overflow: hidden;
        }
        
        /* Canvas styling for Siri orb */
        .voice-circle canvas {
            display: block;
            width: 100%;
            height: 100%;
            border-radius: 50%;
        }
        
        /* Idle State - Subtle ambient glow */
        body[data-state="idle"] .ai-entity {
            filter: drop-shadow(0 0 30px rgba(100, 150, 255, 0.4)) 
                    drop-shadow(0 0 60px rgba(150, 100, 255, 0.2));
            animation: siriIdle 6s ease-in-out infinite;
        }
        
        /* Listening - Active multi-color glow */
        body[data-state="listening"] .ai-entity {
            filter: drop-shadow(0 0 40px rgba(0, 200, 255, 0.5)) 
                    drop-shadow(0 0 80px rgba(0, 150, 200, 0.3));
            animation: siriListening 2s ease-in-out infinite;
        }
        
        /* Thinking - Warm processing glow */
        body[data-state="thinking"] .ai-entity {
            filter: drop-shadow(0 0 45px rgba(255, 180, 50, 0.5)) 
                    drop-shadow(0 0 90px rgba(255, 150, 30, 0.3));
            animation: siriThinking 1.2s ease-in-out infinite;
        }
        
        /* Speaking - Vibrant response glow */
        body[data-state="speaking"] .ai-entity {
            filter: drop-shadow(0 0 50px rgba(50, 220, 150, 0.5)) 
                    drop-shadow(0 0 100px rgba(30, 180, 120, 0.3));
            animation: siriSpeaking 0.6s ease-in-out infinite;
        }
        
        /* Waking - Energized startup glow */
        body[data-state="waking"] .ai-entity {
            filter: drop-shadow(0 0 60px rgba(180, 100, 255, 0.6)) 
                    drop-shadow(0 0 120px rgba(150, 50, 255, 0.3));
            animation: siriWaking 0.8s ease-in-out infinite;
        }
        
        /* Error - Alert glow */
        body[data-state="error"] .ai-entity {
            filter: drop-shadow(0 0 40px rgba(255, 80, 80, 0.6)) 
                    drop-shadow(0 0 80px rgba(255, 50, 50, 0.3));
            animation: siriError 0.4s ease-in-out infinite;
        }
        
        @keyframes siriIdle {
            0%, 100% { 
                filter: drop-shadow(0 0 30px rgba(100, 150, 255, 0.4)) 
                        drop-shadow(0 0 60px rgba(150, 100, 255, 0.2));
                transform: scale(1);
            }
            50% { 
                filter: drop-shadow(0 0 40px rgba(120, 170, 255, 0.5)) 
                        drop-shadow(0 0 80px rgba(170, 120, 255, 0.25));
                transform: scale(1.02);
            }
        }
        
        @keyframes siriListening {
            0%, 100% { 
                filter: drop-shadow(0 0 40px rgba(0, 200, 255, 0.5)) 
                        drop-shadow(0 0 80px rgba(0, 150, 200, 0.3));
                transform: scale(1);
            }
            50% { 
                filter: drop-shadow(0 0 55px rgba(0, 220, 255, 0.6)) 
                        drop-shadow(0 0 100px rgba(0, 170, 220, 0.35));
                transform: scale(1.03);
            }
        }
        
        @keyframes siriThinking {
            0%, 100% { 
                filter: drop-shadow(0 0 45px rgba(255, 180, 50, 0.5)) 
                        drop-shadow(0 0 90px rgba(255, 150, 30, 0.3));
                transform: scale(1) rotate(0deg);
            }
            50% { 
                filter: drop-shadow(0 0 60px rgba(255, 200, 70, 0.6)) 
                        drop-shadow(0 0 110px rgba(255, 170, 50, 0.35));
                transform: scale(1.04) rotate(2deg);
            }
        }
        
        @keyframes siriSpeaking {
            0%, 100% { 
                filter: drop-shadow(0 0 50px rgba(50, 220, 150, 0.5)) 
                        drop-shadow(0 0 100px rgba(30, 180, 120, 0.3));
            }
            50% { 
                filter: drop-shadow(0 0 65px rgba(70, 240, 170, 0.6)) 
                        drop-shadow(0 0 120px rgba(50, 200, 140, 0.35));
            }
        }
        
        @keyframes siriWaking {
            0%, 100% { 
                filter: drop-shadow(0 0 60px rgba(180, 100, 255, 0.6)) 
                        drop-shadow(0 0 120px rgba(150, 50, 255, 0.3));
                transform: scale(1);
            }
            50% { 
                filter: drop-shadow(0 0 80px rgba(200, 120, 255, 0.7)) 
                        drop-shadow(0 0 150px rgba(170, 70, 255, 0.4));
                transform: scale(1.08);
            }
        }
        
        @keyframes siriError {
            0%, 100% { 
                filter: drop-shadow(0 0 40px rgba(255, 80, 80, 0.6)) 
                        drop-shadow(0 0 80px rgba(255, 50, 50, 0.3));
                transform: translateX(0) scale(1);
            }
            25% { 
                transform: translateX(-4px) scale(0.98);
            }
            75% { 
                transform: translateX(4px) scale(0.98);
            }
        }
        
        /* State Label */
        .state-label {
            font-family: var(--font-display);
            font-size: 1.25rem;
            font-weight: 700;
            letter-spacing: 0.2em;
            text-transform: uppercase;
            color: var(--state-color);
            text-shadow: 0 0 20px var(--state-color);
            animation: stateGlow 2s ease-in-out infinite;
        }
        
        @keyframes stateGlow {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }
        
        /* ============================================
           Communication Display - Positioned below center
        ============================================ */
        .comm-display {
            position: fixed;
            top: calc(50% + 200px);
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 700px;
            padding: 0 1rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            pointer-events: none;
            z-index: 40;
        }
        
        .comm-display.visible {
            opacity: 1;
            pointer-events: auto;
        }
        
        .comm-card {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 1.5rem;
            padding: 1.5rem 2rem;
            min-height: 60px;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            transform: translateY(10px);
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .comm-card.active {
            transform: translateY(0);
            opacity: 1;
        }
        
        .comm-label {
            font-family: var(--font-display);
            font-size: 0.75rem;
            font-weight: 600;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            color: var(--state-color);
            opacity: 0.7;
        }
        
        .comm-text {
            font-size: 1.125rem;
            font-weight: 400;
            color: rgba(255, 255, 255, 0.9);
            line-height: 1.6;
            min-height: 1.5rem;
        }
        
        .comm-placeholder {
            font-style: italic;
            color: rgba(255, 255, 255, 0.3);
        }
        
        /* ============================================
           Footer Status Bar - Fixed Bottom, Floating
        ============================================ */
        .ai-footer {
            position: fixed;
            bottom: 1.5rem;
            left: 50%;
            transform: translateX(-50%);
            max-width: 800px;
            width: calc(100% - 3rem);
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1.5rem;
            z-index: 100;
            /* Fully rounded floating pill */
            border-radius: 9999px;
            box-shadow: 
                0 10px 40px rgba(0, 0, 0, 0.4),
                0 0 60px rgba(6, 182, 212, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.15);
        }
        
        .wave-visualizer {
            display: flex;
            align-items: center;
            gap: 4px;
            height: 32px;
        }
        
        .wave-bar {
            width: 4px;
            height: 100%;
            background: linear-gradient(to top, var(--state-color), rgba(255, 255, 255, 0.5));
            border-radius: 2px;
            transform-origin: bottom;
            transition: all 0.3s;
        }
        
        .wave-visualizer.active .wave-bar {
            animation: waveBar 0.8s ease-in-out infinite;
        }
        
        .wave-bar:nth-child(1) { animation-delay: 0s; }
        .wave-bar:nth-child(2) { animation-delay: 0.1s; }
        .wave-bar:nth-child(3) { animation-delay: 0.2s; }
        .wave-bar:nth-child(4) { animation-delay: 0.3s; }
        .wave-bar:nth-child(5) { animation-delay: 0.4s; }
        .wave-bar:nth-child(6) { animation-delay: 0.3s; }
        .wave-bar:nth-child(7) { animation-delay: 0.2s; }
        .wave-bar:nth-child(8) { animation-delay: 0.1s; }
        
        @keyframes waveBar {
            0%, 100% { transform: scaleY(0.3); opacity: 0.5; }
            50% { transform: scaleY(1); opacity: 1; }
        }
        
        .status-info {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }
        
        .status-hint {
            font-size: 0.875rem;
            color: rgba(255, 255, 255, 0.6);
            font-weight: 500;
        }
        
        .status-highlight {
            color: var(--state-color);
            font-weight: 700;
            text-shadow: 0 0 10px var(--state-color);
        }
        
        .mode-indicator {
            font-size: 0.75rem;
            font-family: var(--font-display);
            color: var(--neon-cyan);
            opacity: 0.7;
        }
        
        /* ============================================
           Settings Panel (Unchanged Logic)
        ============================================ */
        .settings-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(20px);
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }
        
        .settings-overlay.open {
            opacity: 1;
            visibility: visible;
        }
        
        .settings-panel {
            background: var(--glass-bg);
            backdrop-filter: blur(40px);
            border: 1px solid var(--glass-border);
            border-radius: 2rem;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }
        
        .settings-header {
            padding: 2rem;
            border-bottom: 1px solid var(--glass-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .settings-title {
            font-family: var(--font-display);
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--neon-cyan);
        }
        
        .settings-content {
            padding: 2rem;
        }
        
        .settings-section {
            margin-bottom: 2rem;
        }
        
        .settings-section-title {
            font-family: var(--font-display);
            font-size: 0.875rem;
            font-weight: 600;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            color: rgba(255, 255, 255, 0.5);
            margin-bottom: 1rem;
        }
        
        .settings-item {
            padding: 1rem 0;
        }
        
        .settings-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .settings-label {
            font-size: 1rem;
            color: rgba(255, 255, 255, 0.8);
        }
        
        /* Settings Input */
        .settings-input {
            width: 100%;
            padding: 0.75rem;
            margin-top: 0.5rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 0.5rem;
            color: #fff;
            font-family: var(--font-body);
            font-size: 0.9rem;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        
        .settings-input:focus {
            outline: none;
            border-color: var(--state-color);
            box-shadow: 0 0 10px rgba(6, 182, 212, 0.3);
        }
        
        .settings-input::placeholder {
            color: rgba(255, 255, 255, 0.3);
        }
        
        /* Toggle Switch */
        .toggle {
            position: relative;
            cursor: pointer;
        }
        
        .toggle input {
            display: none;
        }
        
        .toggle-track {
            width: 50px;
            height: 26px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 13px;
            position: relative;
            transition: background 0.3s;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .toggle input:checked + .toggle-track {
            background: var(--state-color);
            box-shadow: 0 0 20px var(--state-color);
        }
        
        .toggle-thumb {
            width: 20px;
            height: 20px;
            background: #fff;
            border-radius: 50%;
            position: absolute;
            top: 2px;
            left: 2px;
            transition: transform 0.3s;
        }
        
        .toggle input:checked + .toggle-track .toggle-thumb {
            transform: translateX(24px);
        }
        
        /* Slider */
        .slider-container {
            margin-top: 0.5rem;
        }
        
        .slider {
            width: 100%;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            outline: none;
            -webkit-appearance: none;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--state-color);
            cursor: pointer;
            box-shadow: 0 0 10px var(--state-color);
        }
        
        .slider::-moz-range-thumb {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--state-color);
            cursor: pointer;
            border: none;
        }
        
        /* ============================================
           Permission Modal (Unchanged Logic)
        ============================================ */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            z-index: 200;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }
        
        .modal-overlay.open {
            opacity: 1;
            visibility: visible;
        }
        
        .modal {
            background: var(--glass-bg);
            backdrop-filter: blur(40px);
            border: 1px solid var(--glass-border);
            border-radius: 2rem;
            padding: 3rem;
            max-width: 400px;
            text-align: center;
        }
        
        .modal-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 2rem;
            background: linear-gradient(135deg, var(--neon-cyan), var(--neon-magenta));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 40px var(--neon-cyan);
        }
        
        .modal-icon svg {
            width: 40px;
            height: 40px;
            color: #fff;
        }
        
        .modal-title {
            font-family: var(--font-display);
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }
        
        .modal-description {
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 2rem;
            line-height: 1.6;
        }
        
        .modal-actions {
            display: flex;
            gap: 1rem;
        }
        
        .btn {
            flex: 1;
            padding: 1rem 1.5rem;
            border: none;
            border-radius: 1rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-family: var(--font-body);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--neon-cyan), var(--neon-blue));
            color: #fff;
            box-shadow: 0 0 20px var(--neon-cyan);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 30px var(--neon-cyan);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
        }
        
        /* ============================================
           Install Banner (Unchanged Logic)
        ============================================ */
        .install-banner {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--glass-bg);
            backdrop-filter: blur(40px);
            border: 1px solid var(--glass-border);
            border-radius: 1rem;
            padding: 1rem 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s;
            z-index: 50;
            max-width: 90%;
        }
        
        .install-banner.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
            visibility: visible;
        }
        
        .install-banner-text {
            font-size: 0.875rem;
            color: rgba(255, 255, 255, 0.8);
        }
        
        .install-banner-close {
            width: 24px;
            height: 24px;
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.5);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* ============================================
           State-Specific Styling & Animations
        ============================================ */
        body[data-state="idle"] { --state-color: var(--color-idle); }
        body[data-state="waking"] { --state-color: var(--color-waking); }
        body[data-state="listening"] { --state-color: var(--color-listening); }
        body[data-state="thinking"] { --state-color: var(--color-thinking); }
        body[data-state="speaking"] { --state-color: var(--color-speaking); }
        body[data-state="error"] { --state-color: var(--color-error); }
        
        /* ============================================
           Responsive Design
        ============================================ */
        @media (max-width: 768px) {
            .ai-interface {
                padding: 1rem;
                gap: 2rem;
            }
            
            .ai-entity {
                width: 250px;
                height: 250px;
            }
            
            .ai-brain {
                gap: 2rem;
            }
            
            .comm-card {
                padding: 1rem 1.5rem;
            }
            
            .ai-footer {
                padding: 0.75rem 1rem;
                width: calc(100% - 2rem);
                bottom: 1rem;
                gap: 1rem;
            }
            
            .ai-footer .ai-btn {
                width: 40px;
                height: 40px;
            }
            
            .status-hint {
                font-size: 0.75rem;
            }
            
            .settings-panel {
                width: 95%;
            }
        }
        
        @media (max-width: 480px) {
            .ai-entity {
                width: 200px;
                height: 200px;
            }
            
            .state-label {
                font-size: 1rem;
            }
            
            .comm-text {
                font-size: 1rem;
            }
            
            .ai-footer {
                padding: 0.5rem 0.75rem;
                gap: 0.75rem;
            }
            
            .ai-footer .ai-btn {
                width: 36px;
                height: 36px;
            }
            
            .ai-footer .ai-btn svg {
                width: 16px;
                height: 16px;
            }
            
            .status-hint {
                font-size: 0.65rem;
            }
        }
        
        /* ============================================
           Reduced Motion
        ============================================ */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>
<body data-state="idle">
    <!-- Fluid Simulation Background -->
    <div id="fluid-container"></div>
    
    <!-- Main AI Interface -->
    <div class="ai-interface">
        <!-- Central Brain Display -->
        <div class="ai-brain">
            <!-- Liquid Voice Visualizer -->
            <div class="ai-entity">
                <div class="voice-circle">
                    <!-- Liquid canvas will be created here by JavaScript -->
                </div>
            </div>
            
            <!-- State Label -->
            <div class="state-label" id="state-indicator">IDLE</div>
        </div>
        
        <!-- Communication Display - Positioned below center -->
        <div class="comm-display">
            <!-- Transcript -->
            <div class="comm-card" id="transcript-card">
                <div class="comm-label">LISTENING</div>
                <div class="comm-text" id="transcript-text">
                    <span class="comm-placeholder" id="transcript-placeholder">Waiting for your voice...</span>
                </div>
            </div>
            
            <!-- Response -->
            <div class="comm-card" id="response-card">
                <div class="comm-label">RESPONSE</div>
                <div class="comm-text" id="response-text"></div>
            </div>
        </div>
        
        <!-- Footer Status - Floating Pill -->
        <div class="liquid-glass ai-footer">
            <!-- Left: Settings Button -->
            <button class="ai-btn" id="settings-btn" title="Settings">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                </svg>
            </button>
            
            <!-- Center: Status Info -->
            <div class="status-info">
                <div class="status-hint">Say <span class="status-highlight">"Hey Luna"</span> to activate</div>
                <div class="mode-indicator" id="voice-mode-indicator"></div>
            </div>
            
            <!-- Right: Mic Button -->
            <button class="ai-btn mic-btn-footer" id="mic-btn" title="Toggle Microphone">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path>
                </svg>
            </button>
        </div>
    </div>
    
    <!-- Settings Panel -->
    <div class="settings-overlay" id="settings-overlay">
        <div class="settings-panel">
            <div class="settings-header">
                <h2 class="settings-title">SETTINGS</h2>
                <button class="ai-btn" id="close-settings">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            <div class="settings-content">
                <div class="settings-section">
                    <h3 class="settings-section-title">Voice</h3>
                    <div class="settings-item">
                        <div class="settings-row">
                            <span class="settings-label">Wake Word Detection</span>
                            <label class="toggle">
                                <input type="checkbox" id="wake-word-toggle" checked>
                                <div class="toggle-track">
                                    <div class="toggle-thumb"></div>
                                </div>
                            </label>
                        </div>
                    </div>
                    <div class="settings-item">
                        <div class="settings-row">
                            <span class="settings-label">Continuous Listening</span>
                            <label class="toggle">
                                <input type="checkbox" id="continuous-toggle" checked>
                                <div class="toggle-track">
                                    <div class="toggle-thumb"></div>
                                </div>
                            </label>
                        </div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h3 class="settings-section-title">Visualization</h3>
                    <div class="settings-item">
                        <div class="settings-row">
                            <span class="settings-label">Fluid Intensity</span>
                        </div>
                        <div class="slider-container">
                            <input type="range" class="slider" id="fluid-intensity" min="0" max="100" value="50">
                        </div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h3 class="settings-section-title">System</h3>
                    <div class="settings-item">
                        <div class="settings-row">
                            <span class="settings-label">Version</span>
                            <span class="settings-label" style="color: rgba(255,255,255,0.5)">2.0.0</span>
                        </div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h3 class="settings-section-title">API Connection</h3>
                    <div class="settings-item">
                        <div class="settings-row">
                            <span class="settings-label">Luna Server URL</span>
                        </div>
                        <input type="text" 
                               class="settings-input" 
                               id="api-url-input" 
                               placeholder="http://100.101.185.10"
                               value="http://100.101.185.10"
                               style="width: 100%; padding: 0.75rem; margin-top: 0.5rem; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.2); border-radius: 0.5rem; color: #fff; font-family: var(--font-body); font-size: 0.9rem;">
                    </div>
                    <div class="settings-item">
                        <div class="settings-row">
                            <span class="settings-label">Port</span>
                        </div>
                        <input type="number" 
                               class="settings-input" 
                               id="api-port-input" 
                               placeholder="8000"
                               value="8000"
                               style="width: 100%; padding: 0.75rem; margin-top: 0.5rem; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.2); border-radius: 0.5rem; color: #fff; font-family: var(--font-body); font-size: 0.9rem;">
                    </div>
                    <div class="settings-item">
                        <div class="settings-row">
                            <span class="settings-label">Use WebSocket</span>
                            <label class="toggle">
                                <input type="checkbox" id="use-websocket-toggle" checked>
                                <div class="toggle-track">
                                    <div class="toggle-thumb"></div>
                                </div>
                            </label>
                        </div>
                    </div>
                    <div class="settings-item">
                        <div class="settings-row">
                            <span class="settings-label">Connection Status</span>
                            <span class="settings-label" id="api-status-indicator" style="color: rgba(255,100,100,0.8)">Disconnected</span>
                        </div>
                    </div>
                    <div class="settings-item" style="margin-top: 1rem;">
                        <button class="btn btn-primary" id="test-connection-btn" style="width: 100%;">
                            Test Connection
                        </button>
                    </div>
                    <div class="settings-item" style="margin-top: 0.5rem;">
                        <button class="btn btn-secondary" id="connect-api-btn" style="width: 100%;">
                            Connect
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Permission Modal -->
    <div class="modal-overlay" id="mic-permission-modal">
        <div class="modal">
            <div class="modal-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path>
                </svg>
            </div>
            <h2 class="modal-title">Microphone Access</h2>
            <p class="modal-description">LunaEye needs access to your microphone for voice interaction. Your privacy is protected.</p>
            <div class="modal-actions">
                <button class="btn btn-primary" id="grant-mic-btn">Allow</button>
                <button class="btn btn-secondary" id="deny-mic-btn">Deny</button>
            </div>
        </div>
    </div>
    
    <!-- Install Banner -->
    <div class="install-banner" id="install-banner">
        <span class="install-banner-text">Install LunaEye for the best experience</span>
        <button class="btn btn-primary" id="install-btn" style="flex: none; padding: 0.5rem 1rem;">Install</button>
        <button class="install-banner-close" id="close-install-banner">
            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
        </button>
    </div>
    
    <!-- Scripts -->
    <script src="./assets/js/states.js"></script>
    <script src="./assets/js/fluid-simulation.js"></script>
    <script src="./assets/js/voice-visualizer.js"></script>
    <script src="./assets/js/api-client.js"></script>
    <script src="./assets/js/voice.js"></script>
    <script src="./assets/js/ui.js"></script>
    <script src="./assets/js/app.js"></script>
    
    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', async () => {
                try {
                    const registration = await navigator.serviceWorker.register('./sw.js');
                    console.log('Service Worker registered:', registration.scope);
                    
                    registration.addEventListener('updatefound', () => {
                        const newWorker = registration.installing;
                        newWorker.addEventListener('statechange', () => {
                            if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                console.log('New version available');
                            }
                        });
                    });
                } catch (error) {
                    console.log('Service Worker registration failed:', error);
                }
            });
        }
    </script>
</body>
</html>
